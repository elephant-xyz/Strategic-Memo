name: ðŸ“ Split and Convert .tex files to Markdown

on:
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest
    name: Convert LaTeX to Markdown with Frontmatter
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Set up Pandoc
        run: sudo apt-get install pandoc

      - name: Create Output Folder
        run: mkdir -p output

      - name: Convert .tex to .md
        run: |
          for tex_path in *.tex; do
            filename=$(basename "$tex_path" .tex)
            output_path="output/${filename}.md"

            # Extract title from \chapter{...}, fallback to filename
            title=$(grep -m 1 '\\chapter{' "$tex_path" | sed -E 's/.*\\chapter\{([^}]*)\}.*/\1/' | sed 's/"/'\''/g')
            if [ -z "$title" ]; then
              title=$(echo "$filename" | sed 's/_/ /g')
            fi

            # Convert LaTeX to raw markdown
            pandoc "$tex_path" -f latex -t markdown_strict -o temp.md || continue

            # Add YAML frontmatter
            {
              echo "---"
              echo "title: \"$title\""
              echo "source_file: \"$tex_path\""
              echo "---"
              echo ""
              cat temp.md
            } > "$output_path"

            echo "âœ… Converted $tex_path â†’ $output_path"
          done
