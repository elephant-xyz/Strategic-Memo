name: Convert LaTeX to Markdown

on:
  push:
    paths:
      - '**.tex'
      - '.github/workflows/convert-latex.yml'

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install pandoc
        run: |
          sudo apt-get update && sudo apt-get install -y pandoc

      - name: Debug title extraction from .tex files
        run: |
          echo "ðŸ“„ Listing .tex files:"
          ls -l *.tex
          echo "ðŸ“¦ Extracting LaTeX titles (\\chapter{} or \\section{}):"
          grep -Hn '\\chapter{\|\\section{' *.tex || true

      - name: Convert .tex to Markdown
        run: |
          mkdir -p output
          for file in *.tex; do
            filename=$(basename "$file" .tex)
            echo "Converting $file to output/${filename}.md"
            pandoc "$file" -f latex -t markdown --wrap=preserve -o "output/${filename}.md" || true
          done

      - name: Combine into Full Doc
        run: |
          echo "Combining all .md files into output/Full Doc.md"
          cat output/*.md > output/"Full Doc.md"

      - name: Post-run debug for markdown output
        run: |
          echo "ðŸ“‚ Markdown Output Preview:"
          ls -lh output/
          echo "---"
          head -n 20 output/*.md || true
