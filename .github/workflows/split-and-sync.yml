name: âœï¸ Split and Convert .tex files to Markdown

on:
  workflow_dispatch:
  push:
    paths:
      - '*.tex'

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout Repo
        uses: actions/checkout@v3

      - name: ðŸ”§ Set up Pandoc
        run: sudo apt-get install -y pandoc

      - name: ðŸ“„ Split and Convert .tex files to Markdown
        run: |
          mkdir -p output

          for tex_path in *.tex; do
            filename=$(basename "$tex_path" .tex)
            output_path="output/${filename}.md"

            # Extract and sanitize LaTeX title
            raw_title=$(grep -m 1 '\\chapter{' "$tex_path" | sed -E 's/.*\\chapter\{([^}]*)\}.*/\1/')
            clean_title=$(echo "$raw_title" | sed 's/\\[a-zA-Z]*//g' | sed 's/"/'\''/g' | xargs)
            [ -z "$clean_title" ] && clean_title=$(echo "$filename" | sed 's/_/ /g')

            # Convert LaTeX to Markdown with Pandoc
            pandoc "$tex_path" -f latex -t markdown_strict -o temp.md || continue

            # Prepend YAML frontmatter
            {
              echo "---"
              echo "title: \"$clean_title\""
              echo "source_file: \"$tex_path\""
              echo "---"
              echo ""
              cat temp.md
            } > "$output_path"

            echo "âœ… Converted $tex_path â†’ $output_path"
          done
