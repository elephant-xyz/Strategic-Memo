awk -v base="$base_name" -v parent="$slug" '
  BEGIN { RS = "\\\\section\\{"; ORS = ""; filecount = 1 }
  NR > 1 {
    raw = $0
    title = substr(raw, 1, index(raw,"}")-1)
    content = substr(raw, index(raw,"}")+1)

    gsub(/[[:space:]]+$/, "", title)
    gsub(/\\\\|\"/, "", title)
    gsub(/[^[:alnum:] .:-]/, "", title)
    slugified = tolower(title)
    gsub(/[^a-z0-9]+/, "-", slugified)
    gsub(/^-|-$/, "", slugified)

    temp_file = "temp_section.tex"
    outname = "output/" base "_section_" filecount ".md"
    print "\n## " title "\n" > temp_file
    print content >> temp_file

    # Only proceed if the section actually has content
    if (system("test -s " temp_file) == 0) {
      print "---" > outname
      print "title: \"" title "\"" >> outname
      print "slug: \"" slugified "\"" >> outname
      print "parent_slug: \"" parent "\"" >> outname
      print "type: \"section\"" >> outname
      print "order: \"" filecount "\"" >> outname
      print "---\n" >> outname

      cmd = "pandoc -f latex -t markdown_strict " temp_file " >> " outname
      system(cmd)
      filecount++
    } else {
      print "⚠️ Skipping empty section for: " title
    }

    system("rm -f " temp_file)
  }
' "$tex_file"
